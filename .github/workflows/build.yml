name: Build Engine

on: [push, pull_request]

jobs:
  build:
    name: ${{ matrix.config.name }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        os: [ 'ubuntu' ]
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      - name: Checkout submodules
        uses: textbook/git-checkout-submodule-action@master
      - name: Installing pre-build packages
        run: sudo apt-get install build-essential make cmake p7zip-full git
      - name: Apt Update
        run: sudo apt-get update
      # - name: Add Mingw-64 Apt Repo
      #   run: sudo add-apt-repository ppa:tobydox/mingw-x-trusty
      # - name: Install Mingw dependencies
      #   run: >
      #     sudo apt-get install mingw-x-binutils mingw-x-gcc
      #     mingw-x-runtime mingw-x-w32api
      - name: Install build dependencies
        run: >
          sudo apt-get install libglew-dev libsdl2-dev libdevil-dev libopenal-dev 
          libogg-dev libvorbis-dev libfreetype6-dev p7zip-full libxcursor-dev 
          libboost-thread-dev libboost-regex-dev libboost-system-dev 
          libboost-program-options-dev libboost-signals-dev 
          libboost-chrono-dev libboost-filesystem-dev libunwind8-dev 
          default-jdk libcurl4-gnutls-dev
      - name: Setup cross-compile folders
        run: mkdir -p ~/spring-xcompile/win64 ~/spring-xcompile/linux
      - name: Run CMake+Ninja without triplet
        uses: lukka/run-cmake@v2
        id: runcmake
        with:
          cmakeGenerator: 'UnixMakefiles'
          cmakeListsOrSettingsJson: 'CMakeListsTxtAdvanced'
          cmakeListsTxtPath: '${{ github.workspace }}/CMakeLists.txt'
          useShell: bash
          buildWithCMake: false
#      - name: CMake
#        run: cmake .
      - name: Make Engine
        run: make spring
